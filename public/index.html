<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Node REST Server</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
      crossorigin="anonymous"
    />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>
  <body class="bg-light">
    <div class="min-vh-100 d-flex align-items-center justify-content-center">
      <div class="bg-white shadow border rounded p-5">
        <h1>Node REST Server</h1>
        <hr />

        <div class="d-flex flex-column align-items-center gap-3 py-3">
          <div id="google-sign-in" class="d-none">
            <div
              id="g_id_onload"
              data-auto_prompt="false"
              data-client_id="GOOGLE_CLIENT_ID"
              data-callback="handleCredentialResponse"
            ></div>
            <div
              class="g_id_signin"
              data-type="standard"
              data-size="large"
              data-theme="outline"
              data-text="sign_in_with"
              data-shape="rectangular"
              data-logo_alignment="left"
              data-locale="en"
            ></div>
          </div>

          <button
            id="google-sign-out"
            class="btn btn-outline-secondary d-none"
            onclick="handleGoogleLogout()"
          >
            Google Sign Out
          </button>

          <a
            target="_blank"
            href="https://documenter.getpostman.com/view/12311811/2s9Y5ZwNRY"
          >
            API Reference
          </a>
        </div>
      </div>

      <script>
        function handleCredentialResponse({ credential }) {
          fetch(`${location.origin}/api/auth/google`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id_token: credential }),
          })
            .then((res) => res.json())
            .then(({ user }) => {
              user.email && localStorage.setItem('email', user.email);
            })
            .catch(() => localStorage.removeItem('email'));
        }

        function handleGoogleLogout() {
          google.accounts.id.disableAutoSelect();

          google.accounts.id.revoke(localStorage.getItem('email'), (done) => {
            localStorage.removeItem('email');
          });
        }
      </script>
    </div>
  </body>
</html>
